{
  "id": "task_108_shopping_cart",
  "name": "Shopping Cart Calculator",
  "description": "Shopping cart with quantity and price constraints",
  "tier": "tier2_contracts",
  "prompt": "Create a ShoppingCart class with the following:\n- `add_item(self, name: str, price: float, quantity: int = 1)` - Add item (price > 0, quantity > 0)\n- `remove_item(self, name: str, quantity: int = None)` - Remove quantity of item (None = remove all)\n- `update_quantity(self, name: str, quantity: int)` - Set quantity for item (quantity > 0)\n- `get_item(self, name: str) -> dict | None` - Get item details\n- `items` property - List all items as list of dicts with name, price, quantity\n- `subtotal` property - Sum of (price * quantity) for all items\n- `apply_discount(self, percentage: float)` - Apply percentage discount (0-100)\n- `total` property - Subtotal minus discount\n- `item_count` property - Total number of items (sum of quantities)\n- `clear(self)` - Remove all items\n\nRaise ValueError for invalid inputs. Prices should never be negative. Place the implementation in src/core/shopping_cart.py",
  "initial_files": {},
  "test_file": "import pytest\nimport sys\nsys.path.insert(0, 'src')\nfrom core.shopping_cart import ShoppingCart\n\ndef test_add_item():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 3)\n    assert cart.item_count == 3\n    assert cart.subtotal == 4.50\n\ndef test_multiple_items():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 2)\n    cart.add_item(\"Banana\", 0.75, 4)\n    assert cart.item_count == 6\n    assert cart.subtotal == 6.00\n\ndef test_remove_item():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 3)\n    cart.remove_item(\"Apple\", 1)\n    assert cart.item_count == 2\n\ndef test_apply_discount():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 10.00, 1)\n    cart.apply_discount(10)  # 10% off\n    assert cart.total == 9.00\n\ndef test_clear():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 3)\n    cart.clear()\n    assert cart.item_count == 0\n    assert cart.subtotal == 0\n",
  "hidden_test_file": "import pytest\nimport sys\nsys.path.insert(0, 'src')\nfrom core.shopping_cart import ShoppingCart\n\n# Support both ValueError and deal.PreContractError for contract violations\ntry:\n    import deal\n    CONTRACT_ERROR = (ValueError, deal.PreContractError)\nexcept ImportError:\n    CONTRACT_ERROR = ValueError\n\n\ndef test_add_zero_quantity():\n    cart = ShoppingCart()\n    with pytest.raises(CONTRACT_ERROR):\n        cart.add_item(\"Apple\", 1.50, 0)\n\ndef test_add_negative_quantity():\n    cart = ShoppingCart()\n    with pytest.raises(CONTRACT_ERROR):\n        cart.add_item(\"Apple\", 1.50, -1)\n\ndef test_add_zero_price():\n    cart = ShoppingCart()\n    with pytest.raises(CONTRACT_ERROR):\n        cart.add_item(\"Apple\", 0, 1)\n\ndef test_add_negative_price():\n    cart = ShoppingCart()\n    with pytest.raises(CONTRACT_ERROR):\n        cart.add_item(\"Apple\", -1.50, 1)\n\ndef test_remove_more_than_exists():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 3)\n    cart.remove_item(\"Apple\", 5)  # Should remove all, not error\n    assert cart.get_item(\"Apple\") is None\n\ndef test_remove_nonexistent_item():\n    cart = ShoppingCart()\n    # Should not raise, just no-op\n    cart.remove_item(\"Nonexistent\")\n\ndef test_update_quantity_to_zero():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 3)\n    with pytest.raises(CONTRACT_ERROR):\n        cart.update_quantity(\"Apple\", 0)\n\ndef test_discount_over_100():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 10.00, 1)\n    with pytest.raises(CONTRACT_ERROR):\n        cart.apply_discount(101)\n\ndef test_discount_negative():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 10.00, 1)\n    with pytest.raises(CONTRACT_ERROR):\n        cart.apply_discount(-10)\n\ndef test_total_never_negative():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 10.00, 1)\n    cart.apply_discount(100)  # 100% off\n    assert cart.total >= 0\n\ndef test_add_same_item_twice():\n    cart = ShoppingCart()\n    cart.add_item(\"Apple\", 1.50, 2)\n    cart.add_item(\"Apple\", 1.50, 3)  # Should combine\n    assert cart.item_count == 5\n    item = cart.get_item(\"Apple\")\n    assert item[\"quantity\"] == 5\n",
  "expected_files": [
    "src/core/shopping_cart.py"
  ],
  "tags": [
    "class",
    "invariant",
    "ecommerce",
    "validation"
  ],
  "difficulty": "medium"
}
