{
  "id": "exercism_rest_api",
  "name": "Rest Api",
  "description": "Exercism: rest_api",
  "tier": "tier1_standard",
  "prompt": "# Instructions\n\nImplement a RESTful API for tracking IOUs.\n\nFour roommates have a habit of borrowing money from each other frequently, and have trouble remembering who owes whom, and how much.\n\nYour task is to implement a simple [RESTful API][restful-wikipedia] that receives [IOU][iou]s as POST requests, and can deliver specified summary information via GET requests.\n\n## API Specification\n\n### User object\n\n```json\n{\n  \"name\": \"Adam\",\n  \"owes\": {\n    \"Bob\": 12.0,\n    \"Chuck\": 4.0,\n    \"Dan\": 9.5\n  },\n  \"owed_by\": {\n    \"Bob\": 6.5,\n    \"Dan\": 2.75\n  },\n  \"balance\": \"<(total owed by other users) - (total owed to other users)>\"\n}\n```\n\n### Methods\n\n| Description              | HTTP Method | URL    | Payload Format                                                            | Response w/o Payload                   | Response w/ Payload                                                             |\n| ------------------------ | ----------- | ------ | ------------------------------------------------------------------------- | -------------------------------------- | ------------------------------------------------------------------------------- |\n| List of user information | GET         | /users | `{\"users\":[\"Adam\",\"Bob\"]}`                                                | `{\"users\":<List of all User objects>}` | `{\"users\":<List of User objects for <users> (sorted by name)}`                  |\n| Create user              | POST        | /add   | `{\"user\":<name of new user (unique)>}`                                    | N/A                                    | `<User object for new user>`                                                    |\n| Create IOU               | POST        | /iou   | `{\"lender\":<name of lender>,\"borrower\":<name of borrower>,\"amount\":5.25}` | N/A                                    | `{\"users\":<updated User objects for <lender> and <borrower> (sorted by name)>}` |\n\n## Other Resources\n\n- [REST API Tutorial][restfulapi]\n- Example RESTful APIs\n  - [GitHub][github-rest]\n  - [Reddit][reddit-rest]\n\n[restful-wikipedia]: https://en.wikipedia.org/wiki/Representational_state_transfer\n[iou]: https://en.wikipedia.org/wiki/IOU\n[github-rest]: https://developer.github.com/v3/\n[reddit-rest]: https://web.archive.org/web/20231202231149/https://www.reddit.com/dev/api/\n[restfulapi]: https://restfulapi.net/\n\nPlace the implementation in src/core/rest_api.py",
  "initial_files": {},
  "test_file": "import pytest\nimport sys\nsys.path.insert(0, 'src')\nfrom core.rest_api import *\n\n# These tests are auto-generated with test data from:\n# https://github.com/exercism/problem-specifications/tree/main/exercises/rest-api/canonical-data.json\n# File last updated on 2023-07-19\n\nimport json\nimport unittest\n\nfrom rest_api import (\nRestAPI,\n)\n\n\n\ndef test_no_users():\n    database = {\"users\": []}\n    api = RestAPI(database)\n\n    response = api.get(\"/users\")\n    expected = {\"users\": []}\n    assertDictEqual(json.loads(response), expected)\n\ndef test_add_user():\n    database = {\"users\": []}\n    api = RestAPI(database)\n    payload = json.dumps({\"user\": \"Adam\"})\n    response = api.post(\"/add\", payload)\n    expected = {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0}\n    assertDictEqual(json.loads(response), expected)\n\ndef test_get_single_user():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"users\": [\"Bob\"]})\n    response = api.get(\"/users\", payload)\n    expected = {\n        \"users\": [{\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0}]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_both_users_have_0_balance():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Adam\", \"borrower\": \"Bob\", \"amount\": 3.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {\"Bob\": 3.0}, \"balance\": 3.0},\n            {\"name\": \"Bob\", \"owes\": {\"Adam\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_borrower_has_negative_balance():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n            {\"name\": \"Bob\", \"owes\": {\"Chuck\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\"name\": \"Chuck\", \"owes\": {}, \"owed_by\": {\"Bob\": 3.0}, \"balance\": 3.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Adam\", \"borrower\": \"Bob\", \"amount\": 3.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {\"Bob\": 3.0}, \"balance\": 3.0},\n            {\n                \"name\": \"Bob\",\n                \"owes\": {\"Adam\": 3.0, \"Chuck\": 3.0},\n                \"owed_by\": {},\n                \"balance\": -6.0,\n            },\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_lender_has_negative_balance():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n            {\"name\": \"Bob\", \"owes\": {\"Chuck\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\"name\": \"Chuck\", \"owes\": {}, \"owed_by\": {\"Bob\": 3.0}, \"balance\": 3.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Bob\", \"borrower\": \"Adam\", \"amount\": 3.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {\"Bob\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\n                \"name\": \"Bob\",\n                \"owes\": {\"Chuck\": 3.0},\n                \"owed_by\": {\"Adam\": 3.0},\n                \"balance\": 0.0,\n            },\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_lender_owes_borrower():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {\"Bob\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {\"Adam\": 3.0}, \"balance\": 3.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Adam\", \"borrower\": \"Bob\", \"amount\": 2.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {\"Bob\": 1.0}, \"owed_by\": {}, \"balance\": -1.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {\"Adam\": 1.0}, \"balance\": 1.0},\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_lender_owes_borrower_less_than_new_loan():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {\"Bob\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {\"Adam\": 3.0}, \"balance\": 3.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Adam\", \"borrower\": \"Bob\", \"amount\": 4.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {\"Bob\": 1.0}, \"balance\": 1.0},\n            {\"name\": \"Bob\", \"owes\": {\"Adam\": 1.0}, \"owed_by\": {}, \"balance\": -1.0},\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n\ndef test_lender_owes_borrower_same_as_new_loan():\n    database = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {\"Bob\": 3.0}, \"owed_by\": {}, \"balance\": -3.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {\"Adam\": 3.0}, \"balance\": 3.0},\n        ]\n    }\n    api = RestAPI(database)\n    payload = json.dumps({\"lender\": \"Adam\", \"borrower\": \"Bob\", \"amount\": 3.0})\n    response = api.post(\"/iou\", payload)\n    expected = {\n        \"users\": [\n            {\"name\": \"Adam\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n            {\"name\": \"Bob\", \"owes\": {}, \"owed_by\": {}, \"balance\": 0.0},\n        ]\n    }\n    assertDictEqual(json.loads(response), expected)\n",
  "hidden_test_file": "import pytest\nimport sys\nsys.path.insert(0, 'src')\nfrom core.rest_api import *\n\n# Support both ValueError and deal.PreContractError for contract violations\ntry:\n    import deal\n    CONTRACT_ERROR = (ValueError, deal.PreContractError)\nexcept ImportError:\n    CONTRACT_ERROR = ValueError\n\n\n# Edge case tests for rest_api\n# These test boundary conditions and error handling\n\ndef test_edge_case_empty_input():\n    \"\"\"Test behavior with empty input if applicable.\"\"\"\n    # This is a placeholder - actual edge cases depend on the function\n    pass\n\ndef test_edge_case_large_input():\n    \"\"\"Test behavior with large input if applicable.\"\"\"\n    pass\n",
  "expected_files": [
    "src/core/rest_api.py"
  ],
  "tags": [
    "exercism",
    "tier1"
  ],
  "difficulty": "hard"
}